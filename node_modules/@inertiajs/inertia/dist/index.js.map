{"version":3,"file":"index.js","sources":["../src/modal.js","../src/progress.js","../src/inertia.js","../src/should-intercept.js"],"sourcesContent":["export default {\n  modal: null,\n  listener: null,\n\n  show(html) {\n    let page = document.createElement('html')\n    page.innerHTML = html\n    page.querySelectorAll('a').forEach(a => a.setAttribute('target', '_top'))\n\n    this.modal = document.createElement('div')\n    this.modal.style.position = 'fixed'\n    this.modal.style.width = '100vw'\n    this.modal.style.height = '100vh'\n    this.modal.style.padding = '50px'\n    this.modal.style.boxSizing = 'border-box'\n    this.modal.style.backgroundColor = 'rgba(0, 0, 0, .6)'\n    this.modal.style.zIndex = 200000\n    this.modal.addEventListener('click', () => this.hide())\n\n    let iframe = document.createElement('iframe')\n    iframe.style.backgroundColor = 'white'\n    iframe.style.borderRadius = '5px'\n    iframe.style.width = '100%'\n    iframe.style.height = '100%'\n    this.modal.appendChild(iframe)\n\n    document.body.prepend(this.modal)\n    document.body.style.overflow = 'hidden'\n    iframe.contentWindow.document.open()\n    iframe.contentWindow.document.write(page.outerHTML)\n    iframe.contentWindow.document.close()\n\n    this.listener = this.hideOnEscape.bind(this)\n    document.addEventListener('keydown', this.listener)\n  },\n\n  hide() {\n    this.modal.outerHTML = ''\n    this.modal = null\n    document.body.style.overflow = 'visible'\n    document.removeEventListener('keydown', this.listener)\n  },\n\n  hideOnEscape(event) {\n    if (event.keyCode === 27) {\n      this.hide()\n    }\n  },\n}\n","import Nprogress from 'nprogress'\n\nNprogress.configure({ showSpinner: false })\n\nexport default {\n  delay: null,\n  loading: false,\n\n  start() {\n    clearTimeout(this.delay)\n\n    this.delay = setTimeout(() => {\n      this.loading = true\n      Nprogress.set(0)\n      Nprogress.start()\n    }, 250)\n  },\n\n  increment() {\n    if (this.loading) {\n      Nprogress.inc(0.4)\n    }\n  },\n\n  stop() {\n    clearTimeout(this.delay)\n\n    if (this.loading) {\n      Nprogress.done()\n      this.loading = false\n    }\n  },\n}\n","import Axios from 'axios'\nimport Modal from './modal'\nimport Progress from './progress'\n\nexport default {\n  resolveComponent: null,\n  updatePage: null,\n  version: null,\n  visitId: null,\n  cancelToken: null,\n  page: null,\n\n  init({ initialPage, resolveComponent, updatePage }) {\n    this.resolveComponent = resolveComponent\n    this.updatePage = updatePage\n\n    if (window.history.state && this.navigationType() === 'back_forward') {\n      this.setPage(window.history.state)\n    } else if (window.sessionStorage.getItem('inertia.hardVisit')) {\n      window.sessionStorage.removeItem('inertia.hardVisit')\n      this.setPage(initialPage, { preserveState: true })\n    } else {\n      initialPage.url += window.location.hash\n      this.setPage(initialPage)\n    }\n\n    window.addEventListener('popstate', this.restoreState.bind(this))\n  },\n\n  navigationType() {\n    if (window.performance && window.performance.getEntriesByType('navigation').length) {\n      return window.performance.getEntriesByType('navigation')[0].type\n    }\n  },\n\n  isInertiaResponse(response) {\n    return response && response.headers['x-inertia']\n  },\n\n  cancelActiveVisits() {\n    if (this.cancelToken) {\n      this.cancelToken.cancel(this.cancelToken)\n    }\n\n    this.cancelToken = Axios.CancelToken.source()\n  },\n\n  createVisitId() {\n    this.visitId = {}\n    return this.visitId\n  },\n\n  visit(url, { method = 'get', data = {}, replace = false, preserveScroll = false, preserveState = false, only = [] } = {}) {\n    Progress.start()\n    this.cancelActiveVisits()\n    let visitId = this.createVisitId()\n\n    return Axios({\n      method,\n      url: url.toString(),\n      data: method.toLowerCase() === 'get' ? {} : data,\n      params: method.toLowerCase() === 'get' ? data : {},\n      cancelToken: this.cancelToken.token,\n      headers: {\n        Accept: 'text/html, application/xhtml+xml',\n        'X-Requested-With': 'XMLHttpRequest',\n        'X-Inertia': true,\n        ...(only.length ? {\n          'X-Inertia-Partial-Component': this.page.component,\n          'X-Inertia-Partial-Data': only.join(','),\n        } : {}),\n        ...(this.version ? { 'X-Inertia-Version': this.version } : {}),\n      },\n    }).then(response => {\n      if (this.isInertiaResponse(response)) {\n        return response.data\n      } else {\n        Modal.show(response.data)\n      }\n    }).catch(error => {\n      if (Axios.isCancel(error)) {\n        return\n      } else if (error.response.status === 409 && error.response.headers['x-inertia-location']) {\n        Progress.stop()\n        return this.hardVisit(true, error.response.headers['x-inertia-location'])\n      } else if (this.isInertiaResponse(error.response)) {\n        return error.response.data\n      } else if (error.response) {\n        Progress.stop()\n        Modal.show(error.response.data)\n      } else {\n        return Promise.reject(error)\n      }\n    }).then(page => {\n      if (page) {\n        if (only.length) {\n          page.props = { ...this.page.props, ...page.props }\n        }\n\n        return this.setPage(page, { visitId, replace, preserveScroll, preserveState })\n      }\n    })\n  },\n\n  hardVisit(replace, url) {\n    window.sessionStorage.setItem('inertia.hardVisit', true)\n\n    if (replace) {\n      window.location.replace(url)\n    } else {\n      window.location.href = url\n    }\n  },\n\n  setPage(page, { visitId = this.createVisitId(), replace = false, preserveScroll = false, preserveState = false } = {}) {\n    this.page = page\n    Progress.increment()\n    return Promise.resolve(this.resolveComponent(page.component)).then(component => {\n      if (visitId === this.visitId) {\n        preserveState = typeof preserveState === 'function' ? preserveState(page.props) : preserveState\n        preserveScroll = typeof preserveScroll === 'function' ? preserveScroll(page.props) : preserveScroll\n        \n        this.version = page.version\n        this.setState(page, replace, preserveState)\n        this.updatePage(component, page.props, { preserveState })\n        this.setScroll(preserveScroll)\n        Progress.stop()\n      }\n    })\n  },\n\n  setScroll(preserveScroll) {\n    if (!preserveScroll) {\n      document.querySelectorAll('html,body,[scroll-region]')\n        .forEach(region => region.scrollTo(0, 0))\n    }\n  },\n\n  setState(page, replace = false, preserveState = false) {\n    if (replace || page.url === `${window.location.pathname}${window.location.search}`) {\n      window.history.replaceState({\n        ...{ cache: preserveState && window.history.state ? window.history.state.cache : {} },\n        ...page,\n      }, '', page.url)\n    } else {\n      window.history.pushState({\n        cache: {},\n        ...page,\n      }, '', page.url)\n    }\n  },\n\n  restoreState(event) {\n    if (event.state) {\n      this.setPage(event.state)\n    }\n  },\n\n  replace(url, options = {}) {\n    return this.visit(url, { preserveState: true, ...options, replace: true })\n  },\n\n  reload(options = {}) {\n    return this.replace(window.location.href, options)\n  },\n\n  post(url, data = {}, options = {}) {\n    return this.visit(url, { preserveState: true, ...options, method: 'post', data })\n  },\n\n  put(url, data = {}, options = {}) {\n    return this.visit(url, { preserveState: true, ...options, method: 'put', data })\n  },\n\n  patch(url, data = {}, options = {}) {\n    return this.visit(url, { preserveState: true, ...options, method: 'patch', data })\n  },\n\n  delete(url, options = {}) {\n    return this.visit(url, { ...options, method: 'delete' })\n  },\n\n  remember(data, key = 'default') {\n    let newState = { ...window.history.state }\n    newState.cache = newState.cache || {}\n    newState.cache[key] = data\n    this.setState(newState)\n  },\n\n  restore(key = 'default') {\n    if (window.history.state.cache && window.history.state.cache[key]) {\n      return window.history.state.cache[key]\n    }\n  },\n}\n","export default function shouldIntercept(event) {\n  return !(\n    (event.target && event.target.isContentEditable)\n    || event.defaultPrevented\n    || event.which > 1\n    || event.altKey\n    || event.ctrlKey\n    || event.metaKey\n    || event.shiftKey\n  )\n}\n"],"names":["modal","listener","show","html","page","document","createElement","innerHTML","querySelectorAll","forEach","a","setAttribute","style","position","width","height","padding","boxSizing","backgroundColor","zIndex","addEventListener","this","hide","iframe","borderRadius","appendChild","body","prepend","overflow","contentWindow","open","write","outerHTML","close","hideOnEscape","bind","removeEventListener","event","keyCode","configure","showSpinner","delay","loading","start","clearTimeout","setTimeout","Nprogress","set","increment","inc","stop","done","resolveComponent","updatePage","version","visitId","cancelToken","init","window","history","state","navigationType","setPage","sessionStorage","getItem","removeItem","initialPage","preserveState","url","location","hash","restoreState","performance","getEntriesByType","length","type","isInertiaResponse","response","headers","cancelActiveVisits","cancel","Axios","CancelToken","source","createVisitId","visit","Progress","method","toString","data","toLowerCase","params","token","Object","Accept","only","component","join","then","Modal","catch","error","isCancel","status","hardVisit","Promise","reject","props","replace","preserveScroll","setItem","href","resolve","setState","setScroll","region","scrollTo","replaceState","cache","pushState","options","reload","post","put","patch","delete","remember","key","newState","restore","target","isContentEditable","defaultPrevented","which","altKey","ctrlKey","metaKey","shiftKey"],"mappings":"4HAAe,CACbA,MAAO,KACPC,SAAU,KAEVC,cAAKC,cACCC,EAAOC,SAASC,cAAc,QAClCF,EAAKG,UAAYJ,EACjBC,EAAKI,iBAAiB,KAAKC,iBAAQC,UAAKA,EAAEC,aAAa,SAAU,eAE5DX,MAAQK,SAASC,cAAc,YAC/BN,MAAMY,MAAMC,SAAW,aACvBb,MAAMY,MAAME,MAAQ,aACpBd,MAAMY,MAAMG,OAAS,aACrBf,MAAMY,MAAMI,QAAU,YACtBhB,MAAMY,MAAMK,UAAY,kBACxBjB,MAAMY,MAAMM,gBAAkB,yBAC9BlB,MAAMY,MAAMO,OAAS,SACrBnB,MAAMoB,iBAAiB,0BAAeC,EAAKC,aAE5CC,EAASlB,SAASC,cAAc,UACpCiB,EAAOX,MAAMM,gBAAkB,QAC/BK,EAAOX,MAAMY,aAAe,MAC5BD,EAAOX,MAAME,MAAQ,OACrBS,EAAOX,MAAMG,OAAS,YACjBf,MAAMyB,YAAYF,GAEvBlB,SAASqB,KAAKC,QAAQN,KAAKrB,OAC3BK,SAASqB,KAAKd,MAAMgB,SAAW,SAC/BL,EAAOM,cAAcxB,SAASyB,OAC9BP,EAAOM,cAAcxB,SAAS0B,MAAM3B,EAAK4B,WACzCT,EAAOM,cAAcxB,SAAS4B,aAEzBhC,SAAWoB,KAAKa,aAAaC,KAAKd,MACvChB,SAASe,iBAAiB,UAAWC,KAAKpB,WAG5CqB,qBACOtB,MAAMgC,UAAY,QAClBhC,MAAQ,KACbK,SAASqB,KAAKd,MAAMgB,SAAW,UAC/BvB,SAAS+B,oBAAoB,UAAWf,KAAKpB,WAG/CiC,sBAAaG,GACW,KAAlBA,EAAMC,cACHhB,WC3CDiB,UAAU,CAAEC,aAAa,IAEnC,MAAe,CACbC,MAAO,KACPC,SAAS,EAETC,4BACEC,aAAavB,KAAKoB,YAEbA,MAAQI,wBACNH,SAAU,EACfI,EAAUC,IAAI,GACdD,EAAUH,SACT,MAGLK,qBACM3B,KAAKqB,SACPI,EAAUG,IAAI,KAIlBC,gBACEN,aAAavB,KAAKoB,OAEdpB,KAAKqB,UACPI,EAAUK,YACLT,SAAU,qBCzBN,CACbU,iBAAkB,KAClBC,WAAY,KACZC,QAAS,KACTC,QAAS,KACTC,YAAa,KACbpD,KAAM,KAENqD,yDACOL,yCACAC,WAAaA,EAEdK,OAAOC,QAAQC,OAAmC,iBAA1BvC,KAAKwC,sBAC1BC,QAAQJ,OAAOC,QAAQC,OACnBF,OAAOK,eAAeC,QAAQ,sBACvCN,OAAOK,eAAeE,WAAW,0BAC5BH,QAAQI,EAAa,CAAEC,eAAe,MAE3CD,EAAYE,KAAOV,OAAOW,SAASC,UAC9BR,QAAQI,IAGfR,OAAOtC,iBAAiB,WAAYC,KAAKkD,aAAapC,KAAKd,QAG7DwC,6BACMH,OAAOc,aAAed,OAAOc,YAAYC,iBAAiB,cAAcC,cACnEhB,OAAOc,YAAYC,iBAAiB,cAAc,GAAGE,MAIhEC,2BAAkBC,UACTA,GAAYA,EAASC,QAAQ,cAGtCC,8BACM1D,KAAKmC,kBACFA,YAAYwB,OAAO3D,KAAKmC,kBAG1BA,YAAcyB,EAAMC,YAAYC,UAGvCC,qCACO7B,QAAU,GACRlC,KAAKkC,SAGd8B,eAAMjB,+BAAgH,kCAAhG,mCAAc,oCAAc,0CAAwB,yCAAuB,+BAAc,IAC7GkB,EAAS3C,aACJoC,yBACDxB,EAAUlC,KAAK+D,uBAEZH,EAAM,QACXM,EACAnB,IAAKA,EAAIoB,WACTC,KAA+B,QAAzBF,EAAOG,cAA0B,GAAKD,EAC5CE,OAAiC,QAAzBJ,EAAOG,cAA0BD,EAAO,GAChDjC,YAAanC,KAAKmC,YAAYoC,MAC9Bd,QAASe,kBACPC,OAAQ,sDACY,8BACP,GACTC,EAAKrB,OAAS,+BACerD,KAAKjB,KAAK4F,mCACfD,EAAKE,KAAK,MAClC,GACA5E,KAAKiC,QAAU,qBAAuBjC,KAAKiC,SAAY,MAE5D4C,cAAKrB,MACFxD,EAAKuD,kBAAkBC,UAClBA,EAASY,KAEhBU,EAAMjG,KAAK2E,EAASY,QAErBW,eAAMC,OACHpB,EAAMqB,SAASD,GAEZ,OAA8B,MAA1BA,EAAMxB,SAAS0B,QAAkBF,EAAMxB,SAASC,QAAQ,uBACjEQ,EAASpC,OACF7B,EAAKmF,WAAU,EAAMH,EAAMxB,SAASC,QAAQ,wBAC1CzD,EAAKuD,kBAAkByB,EAAMxB,UAC/BwB,EAAMxB,SAASY,KACbY,EAAMxB,UACfS,EAASpC,YACTiD,EAAMjG,KAAKmG,EAAMxB,SAASY,OAEnBgB,QAAQC,OAAOL,KAEvBH,cAAK9F,MACFA,SACE2F,EAAKrB,SACPtE,EAAKuG,MAAQd,iBAAKxE,EAAKjB,KAAKuG,MAAUvG,EAAKuG,QAGtCtF,EAAKyC,QAAQ1D,EAAM,SAAEmD,UAASqD,iBAASC,gBAAgB1C,OAKpEqC,mBAAUI,EAASxC,GACjBV,OAAOK,eAAe+C,QAAQ,qBAAqB,GAE/CF,EACFlD,OAAOW,SAASuC,QAAQxC,GAExBV,OAAOW,SAAS0C,KAAO3C,GAI3BN,iBAAQ1D,+BAA2G,mCAAzFiB,KAAK+D,iDAA2B,0CAAwB,gDAAuB,QAClGhF,KAAOA,EACZkF,EAAStC,YACFyD,QAAQO,QAAQ3F,KAAK+B,iBAAiBhD,EAAK4F,YAAYE,cAAKF,GAC7DzC,IAAYlC,EAAKkC,UACnBY,EAAyC,mBAAlBA,EAA+BA,EAAc/D,EAAKuG,OAASxC,EAClF0C,EAA2C,mBAAnBA,EAAgCA,EAAezG,EAAKuG,OAASE,IAEhFvD,QAAUlD,EAAKkD,UACf2D,SAAS7G,EAAMwG,EAASzC,KACxBd,WAAW2C,EAAW5F,EAAKuG,MAAO,eAAExC,MACpC+C,UAAUL,GACfvB,EAASpC,WAKfgE,mBAAUL,GACHA,GACHxG,SAASG,iBAAiB,6BACvBC,iBAAQ0G,UAAUA,EAAOC,SAAS,EAAG,MAI5CH,kBAAS7G,EAAMwG,EAAiBzC,mBAAP,mBAAuB,GAC1CyC,GAAWxG,EAAKgE,SAAWV,OAAOW,kBAAoBX,OAAOW,gBAC/DX,OAAOC,QAAQ0D,aAAaxB,kBACrByB,MAAOnD,GAAiBT,OAAOC,QAAQC,MAAQF,OAAOC,QAAQC,MAAM0D,MAAQ,IAC9ElH,GACF,GAAIA,EAAKgE,KAEZV,OAAOC,QAAQ4D,UAAU1B,kBACvByB,MAAO,IACJlH,GACF,GAAIA,EAAKgE,MAIhBG,sBAAalC,GACPA,EAAMuB,YACHE,QAAQzB,EAAMuB,QAIvBgD,iBAAQxC,EAAKoD,yBAAU,IACdnG,KAAKgE,MAAMjB,EAAKyB,kBAAE1B,eAAe,GAASqD,GAASZ,SAAS,MAGrEa,gBAAOD,yBAAU,IACRnG,KAAKuF,QAAQlD,OAAOW,SAAS0C,KAAMS,IAG5CE,cAAKtD,EAAKqB,EAAW+B,yBAAJ,mBAAc,IACtBnG,KAAKgE,MAAMjB,EAAKyB,kBAAE1B,eAAe,GAASqD,GAASjC,OAAQ,YAAQE,MAG5EkC,aAAIvD,EAAKqB,EAAW+B,yBAAJ,mBAAc,IACrBnG,KAAKgE,MAAMjB,EAAKyB,kBAAE1B,eAAe,GAASqD,GAASjC,OAAQ,WAAOE,MAG3EmC,eAAMxD,EAAKqB,EAAW+B,yBAAJ,mBAAc,IACvBnG,KAAKgE,MAAMjB,EAAKyB,kBAAE1B,eAAe,GAASqD,GAASjC,OAAQ,aAASE,MAG7EoC,gBAAOzD,EAAKoD,yBAAU,IACbnG,KAAKgE,MAAMjB,EAAKyB,iBAAK2B,GAASjC,OAAQ,aAG/CuC,kBAASrC,EAAMsC,kBAAM,eACfC,EAAWnC,iBAAKnC,OAAOC,QAAQC,OACnCoE,EAASV,MAAQU,EAASV,OAAS,GACnCU,EAASV,MAAMS,GAAOtC,OACjBwB,SAASe,IAGhBC,iBAAQF,qBAAM,WACRrE,OAAOC,QAAQC,MAAM0D,OAAS5D,OAAOC,QAAQC,MAAM0D,MAAMS,UACpDrE,OAAOC,QAAQC,MAAM0D,MAAMS,6BC/LzB,SAAyB1F,WAEnCA,EAAM6F,QAAU7F,EAAM6F,OAAOC,mBAC3B9F,EAAM+F,kBACN/F,EAAMgG,MAAQ,GACdhG,EAAMiG,QACNjG,EAAMkG,SACNlG,EAAMmG,SACNnG,EAAMoG"}